/*
 # -----------------------------------------------------------------------------
 # ~/assets/theme/j1/modules/lightGallery/js/plugins/lg-video.min.js
 # Provides lightGallery JS code for the plugin lgVideo
 #
 # Product/Info:
 # https://jekyll.one
 #
 # Copyright (C) 2023 Sachin Neravath
 # Copyright (C) 2023, 2024 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE
 # lightGallery is licensed under the GPLv3 license
 # See: https://github.com/sachinchoolur/lightGallery/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/

/*
 * lightgallery | 2.7.2 | September 20th 2023
 * http://www.lightgalleryjs.com/
 * Copyright (c) 2020 Sachin Neravath;
 * @license GPLv3
*/

!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(e="undefined"!=typeof globalThis?globalThis:e||self).lgVideo=o()}(this,(function(){"use strict";var e=new URL(window.location.href).origin,o=function(){return o=Object.assign||function(e){for(var o,t=1,i=arguments.length;t<i;t++)for(var s in o=arguments[t])Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);return e},o.apply(this,arguments)},t={autoplayFirstVideo:!0,htmlPlayerParams:!1,youTubePlayerParams:!1,vimeoPlayerParams:!1,dailymotionPlayerParams:!1,wistiaPlayerParams:!1,tiktokPlayerParams:!1,gotoNextSlideOnVideoEnd:!0,autoplayVideoOnSlide:!1,videojs:!1,videojsTheme:"",videojsOptions:{}},i="lgHasVideo",s="lgSlideItemLoad",n="lgBeforeSlide",a="lgAfterSlide",r="lgPosterClick",l=function(e){return Object.keys(e).map((function(o){return encodeURIComponent(o)+"="+encodeURIComponent(e[o])})).join("&")},d=function(t,i){if(!t.youtube)return"";var s=t.youtube[2]?function(e){return e.slice(1).split("&").map((function(e){return e.split("=")})).reduce((function(e,o){var t=o.map(decodeURIComponent),i=t[0],s=t[1];return e[i]=s,e}),{})}(t.youtube[2]):"",n=i||{},a=o(o(o({},{autoplay:0,controls:1,enablejsapi:1,hl:"en",loop:0,mute:1,wmode:"opaque",origin:e}),n),s);return"?"+l(a)},c=function(){function e(e){return this.core=e,this.settings=o(o({},t),this.core.settings),this}return e.prototype.init=function(){var e=this;this.core.LGel.on(i+".video",this.onHasVideo.bind(this)),this.core.LGel.on(r+".video",(function(){var o=e.core.getSlideItem(e.core.index);e.loadVideoOnPosterClick(o)})),this.core.LGel.on(s+".video",this.onSlideItemLoad.bind(this)),this.core.LGel.on(n+".video",this.onBeforeSlide.bind(this)),this.core.LGel.on(a+".video",this.onAfterSlide.bind(this))},e.prototype.onSlideItemLoad=function(e){var o=this,t=e.detail,i=t.isFirstSlide,s=t.index;this.settings.autoplayFirstVideo&&i&&s===this.core.index&&setTimeout((function(){o.loadAndPlayVideo(s)}),200),!i&&this.settings.autoplayVideoOnSlide&&s===this.core.index&&this.loadAndPlayVideo(s)},e.prototype.onHasVideo=function(e){var o=e.detail,t=o.index,i=o.src,s=o.html5Video;if(o.hasPoster)this.core.getSlideItem(t);else this.appendVideos(this.core.getSlideItem(t),{src:i,addClass:"lg-object",index:t,html5Video:s}),this.gotoNextSlideOnVideoEnd(i,t)},e.prototype.onBeforeSlide=function(e){if(this.core.lGalleryOn){var o=e.detail.prevIndex;this.pauseVideo(o)}},e.prototype.onAfterSlide=function(e){var o=this,t=e.detail,i=t.index,s=t.prevIndex,n=this.core.getSlideItem(i);this.settings.autoplayVideoOnSlide&&i!==s&&n.hasClass("lg-complete")&&setTimeout((function(){o.loadAndPlayVideo(i)}),100)},e.prototype.loadAndPlayVideo=function(e){var o=this.core.getSlideItem(e);this.core.galleryItems[e].poster?this.loadVideoOnPosterClick(o,!0):this.playVideo(e)},e.prototype.playVideo=function(e){this.controlVideo(e,"play")},e.prototype.pauseVideo=function(e){this.controlVideo(e,"pause")},e.prototype.getVideoHtml=function(e,o,t,i){var s="",n=this.core.galleryItems[t].__slideVideoInfo||{},a=this.core.galleryItems[t],r=a.title||a.alt;r=r?'title="'+r+'"':"";var c='allowtransparency="true"\n            frameborder="0"\n            scrolling="no"\n            allowfullscreen\n            mozallowfullscreen\n            webkitallowfullscreen\n            msallowfullscreen';if(n.youtube){var u="lg-youtube"+t,m=d(n,this.settings.youTubePlayerParams),f=function(e){return e.includes("youtube-nocookie.com")}(e);s='<iframe allow="autoplay" id='+u+' class="lg-video-object lg-youtube '+o+'" '+r+' src="'+(f?"//www.youtube-nocookie.com/":"//www.youtube.com/")+"embed/"+(n.youtube[1]+m)+'" '+c+"></iframe>"}else if(n.vimeo){u="lg-vimeo"+t;var h=function(e,o){if(!o||!o.vimeo)return"";var t=o.vimeo[2]||"",i=e&&0!==Object.keys(e).length?"&"+l(e):"",s=((o.vimeo[0].split("/").pop()||"").split("?")[0]||"").split("#")[0],n=o.vimeo[1]!==s;return n&&(t=t.replace("/"+s,"")),"?autoplay=0&muted=1"+(n?"&h="+s:"")+i+("?"==t[0]?"&"+t.slice(1):t||"")}(this.settings.vimeoPlayerParams,n);s='<iframe allow="autoplay" id='+u+' class="lg-video-object lg-vimeo '+o+'" '+r+' src="//player.vimeo.com/video/'+(n.vimeo[1]+h)+'" '+c+"></iframe>"}else if(n.wistia){var p="lg-wistia"+t;h=(h=l(this.settings.wistiaPlayerParams))?"?"+h:"",s='<iframe allow="autoplay" id="'+p+'" src="//fast.wistia.net/embed/'+n.wistia[3]+(n.wistia[4]+h)+'" '+r+' class="wistia_embed lg-video-object lg-wistia '+o+'" name="wistia_embed" '+c+"></iframe>"}else if(n.dailymotion){var v="lg-dailymotion"+t;h=(h=l(this.settings.dailymotionPlayerParams))?"?"+h:"",s='<iframe allow="autoplay" id="'+v+'" src="//www.dailymotion.com/embed/video/'+(n.dailymotion[1]+h)+'" '+r+' class="dailymotion_embed lg-video-object lg-dailymotion '+o+'" name="dailymotion_embed" '+c+"></iframe>"}else if(n.tiktoc){h=function(e,o){if(!o||!o.tiktok)return"";var t=o.tiktok[2]||"",i=e&&0!==Object.keys(e).length?"&"+l(e):"",s=((o.tiktok[0].split("/").pop()||"").split("?")[0]||"").split("#")[0];return o.tiktok[1]!==s&&(t=t.replace("/"+s,"")),"?autoplay=0&muted=1"+i+("?"==t[0]?"&"+t.slice(1):t||"")}(this.settings.TicTocPlayerParams);s='<iframe allow="autoplay" id='+u+' class="lg-video-object lg-tictoc '+o+'" '+r+' src="//tiktok.com/embed/'+n.tiktoc[1]+'" '+r+c+"></iframe>"}else if(n.html5){for(var y="",g=0;g<i.source.length;g++)y+='<source src="'+i.source[g].src+'" type="'+i.source[g].type+'">';if(i.tracks){var b=function(e){var o="",t=i.tracks[e];Object.keys(t||{}).forEach((function(e){o+=e+'="'+t[e]+'" '})),y+="<track "+o+">"};for(g=0;g<i.tracks.length;g++)b(g)}var w="",k=i.attributes||{};Object.keys(k||{}).forEach((function(e){w+=e+'="'+k[e]+'" '})),s='<video class="lg-video-object lg-html5 '+(this.settings.videojs&&this.settings.videojsTheme?this.settings.videojsTheme+" ":"")+" "+(this.settings.videojs?" video-js":"")+'" '+w+">\n                "+y+"\n                Your browser does not support HTML5 video.\n            </video>"}return s},e.prototype.appendVideos=function(e,o){var t,i=this.getVideoHtml(o.src,o.addClass,o.index,o.html5Video);e.find(".lg-video-cont").append(i);var s=e.find(".lg-video-object").first();if(o.html5Video&&s.on("mousedown.lg.video",(function(e){e.stopPropagation()})),this.settings.videojs&&(null===(t=this.core.galleryItems[o.index].__slideVideoInfo)||void 0===t?void 0:t.html5))try{return videojs(s.get(),this.settings.videojsOptions)}catch(e){console.warn("lightGallery: Make sure you have included videojs")}},e.prototype.gotoNextSlideOnVideoEnd=function(e,o){var t=this,i=this.core.getSlideItem(o).find(".lg-video-object").first(),s=this.core.galleryItems[o].__slideVideoInfo||{};if(this.settings.gotoNextSlideOnVideoEnd)if(s.html5)i.on("ended",(function(){t.core.goToNextSlide()}));else if(s.vimeo)try{new Vimeo.Player(i.get()).on("ended",(function(){t.core.goToNextSlide()}))}catch(e){console.warn("lightGallery: Make sure you have included //github.com/vimeo/player.js")}else if(s.wistia)try{window._wq=window._wq||[],window._wq.push({id:i.attr("id"),onReady:function(e){e.bind("end",(function(){t.core.goToNextSlide()}))}})}catch(e){console.warn("lightGallery: Make sure you have included //fast.wistia.com/assets/external/E-v1.js")}},e.prototype.controlVideo=function(e,t){var i,s,n,a,r,l,d,c,u,m=!1;if(n=this.core.galleryItems[e].__slideVideoInfo||{},s=this.core.getSlideItem(e).find(".lg-video-object").first(),void 0!==this.core.galleryItems[this.core.index].video&&n.html5){if(void 0!==(r=JSON.parse(this.core.galleryItems[this.core.index].video)).tracks&&r.tracks.length>0)for(var f=0;f<r.tracks.length;f++)"chapters"==r.tracks[f].kind&&(i=r.tracks[f].src,m=!0);if(void 0!==s.selector?(l=s.selector.id,d=videojs(l)):d="unknown","unknown"!==d){var h=this.settings.videojsOptions.controlBar.hotkeysPlugin,p=this.settings.videojsOptions.controlBar.zoomPlugin,v=void 0!==this.settings.videojsOptions.controlBar.playbackRates?this.settings.videojsOptions.controlBar.playbackRates:"[0.25, 0.5, 1, 1.5, 2]";if(void 0!==this.settings.videojsOptions.videoStart&&(a=this.settings.videojsOptions.videoStart[e],d.on("play",(function(){var e=new Date("1970-01-01T"+a+"Z").getTime()/1e3;d.currentTime(e)}))),d.playbackRates(v),void 0!==h&&h.enabled&&(h.options=o(o({},{volumeStep:.1,seekStep:5,enableMute:!0,enableVolumeScroll:!0,enableHoverScroll:!1,enableFullscreen:!0,enableNumbers:!0,enableJogStyle:!1,alwaysCaptureHotkeys:!1,captureDocumentHotkeys:!1,enableModifiersForNumbers:!1,enableInactiveFocus:!0,skipInitialFocus:!1}),h.options),d.hotkeys({enableModifiersForNumbers:h.options.enableModifiersForNumbers})),void 0!==p&&p.enabled&&(p.options=o(o({},{moveX:0,moveY:0,rotate:0,zoom:1}),p.options),d.zoomPlugin({moveX:p.options.moveX,moveY:p.options.moveY,rotate:p.options.rotate,zoom:p.options.zoom})),m){var y=new WebVTTParser,g=[];function b(e){for(var o,t=y.parse(e,"metadata"),i=0;i<t.cues.length;i++)o={time:t.cues[i].startTime,label:t.cues[i].text},g.push(o)}c=i,u=b,new WebVTTParser,$.ajax({url:c,type:"GET",success:u,error:function(e){JSON.stringify(e,void 0,2)}}),d.on("play",(function(){d.currentTime(a);var e=d.duration(),o=$(d.controlBar.progressControl.children_[0].el_);setTimeout((function(){var t=setInterval((function(){if(g.length){for(var i=0;i<g.length;i++){var s=g[i].time/e*100+"%",n=g[i].time,a=$('<div class="vjs-chapter-marker" style="left: '+s+'" data-time="'+n+'"> <span>'+g[i].label+"</span></div>");a.click((function(){d.currentTime($(this).data("time"))})),o.append(a)}clearInterval(t)}}),10)}),1e3)}))}}}if(s.get())if(n.youtube)try{s.get().contentWindow.postMessage('{"event":"command","func":"'+t+'Video","args":""}',"*")}catch(w){console.error("lightGallery:- "+w)}else if(n.vimeo)try{new Vimeo.Player(s.get())[t]()}catch(k){console.warn("lightGallery: Make sure you have included //github.com/vimeo/player.js")}else if(n.html5)if(this.settings.videojs)try{videojs(s.get())[t]()}catch(V){console.warn("lightGallery: Make sure you have included videojs")}else s.get()[t]();else if(n.wistia)try{window._wq=window._wq||[],window._wq.push({id:s.attr("id"),onReady:function(e){e[t]()}})}catch(j){console.warn("lightGallery: Make sure you have included //fast.wistia.com/assets/external/E-v1.js")}},e.prototype.loadVideoOnPosterClick=function(e,o){var t=this;if(e.hasClass("lg-video-loaded"))o&&this.playVideo(this.core.index);else if(e.hasClass("lg-has-video"))this.playVideo(this.core.index);else{e.addClass("lg-has-video");var i=void 0,s=this.core.galleryItems[this.core.index].src,n=this.core.galleryItems[this.core.index].video;n&&(i="string"==typeof n?JSON.parse(n):n);var a=this.appendVideos(e,{src:s,addClass:"",index:this.core.index,html5Video:i});this.gotoNextSlideOnVideoEnd(s,this.core.index);var r=e.find(".lg-object").first().get();e.find(".lg-video-cont").first().append(r),e.addClass("lg-video-loading"),a&&a.ready((function(){a.on("loadedmetadata",(function(){t.onVideoLoadAfterPosterClick(e,t.core.index)}))})),e.find(".lg-video-object").first().on("load.lg error.lg loadedmetadata.lg",(function(){setTimeout((function(){t.onVideoLoadAfterPosterClick(e,t.core.index)}),50)}))}},e.prototype.onVideoLoadAfterPosterClick=function(e,o){e.addClass("lg-video-loaded"),this.playVideo(o)},e.prototype.destroy=function(){this.core.LGel.off(".lg.video"),this.core.LGel.off(".video")},e}();return c}));
